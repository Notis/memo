<!DOCTYPE html>
<html lang="en-US" class="no-js">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<link rel="profile" href="http://gmpg.org/xfn/11">
	<link rel="pingback" href="http://youngblog.hoster-ok.com/xmlrpc.php">
	<!--[if lt IE 9]>
	<script src="http://youngblog.hoster-ok.com/wp-content/themes/twentyfifteen/js/html5.js"></script>
	<![endif]-->
	<script>(function(html){html.className = html.className.replace(/\bno-js\b/,'js')})(document.documentElement);</script>
<title>Установка openvpn на Linux mint &#8211; youngblogger на hoster-ok.com</title>
<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link href='https://fonts.gstatic.com' crossorigin rel='preconnect' />
<link rel="alternate" type="application/rss+xml" title="youngblogger на hoster-ok.com &raquo; Feed" href="http://youngblog.hoster-ok.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="youngblogger на hoster-ok.com &raquo; Comments Feed" href="http://youngblog.hoster-ok.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="youngblogger на hoster-ok.com &raquo; Установка openvpn на Linux mint Comments Feed" href="http://youngblog.hoster-ok.com/ustanovka-openvpn-na-linux-mint/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.2.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.2.1\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/youngblog.hoster-ok.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.7.7"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),!(j.toDataURL().length<3e3)&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57331,65039,8205,55356,57096),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57331,55356,57096),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55357,56425,55356,57341,8205,55357,56507),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55357,56425,55356,57341,55357,56507),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='cptch_stylesheet-css'  href='http://youngblog.hoster-ok.com/wp-content/plugins/captcha/css/style.css?ver=4.7.7' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='http://youngblog.hoster-ok.com/wp-includes/css/dashicons.min.css?ver=4.7.7' type='text/css' media='all' />
<link rel='stylesheet' id='cptch_desktop_style-css'  href='http://youngblog.hoster-ok.com/wp-content/plugins/captcha/css/desktop_style.css?ver=4.7.7' type='text/css' media='all' />
<link rel='stylesheet' id='contact-form-7-css'  href='http://youngblog.hoster-ok.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=4.6' type='text/css' media='all' />
<link rel='stylesheet' id='quotescollection-css'  href='http://youngblog.hoster-ok.com/wp-content/plugins/quotes-collection/css/quotes-collection.css?ver=2.0.8' type='text/css' media='all' />
<link rel='stylesheet' id='twentyfifteen-fonts-css'  href='https://fonts.googleapis.com/css?family=Noto+Sans%3A400italic%2C700italic%2C400%2C700%7CNoto+Serif%3A400italic%2C700italic%2C400%2C700%7CInconsolata%3A400%2C700&#038;subset=latin%2Clatin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='genericons-css'  href='http://youngblog.hoster-ok.com/wp-content/themes/twentyfifteen/genericons/genericons.css?ver=3.2' type='text/css' media='all' />
<link rel='stylesheet' id='twentyfifteen-style-css'  href='http://youngblog.hoster-ok.com/wp-content/themes/twentyfifteen-child/style.css?ver=4.7.7' type='text/css' media='all' />
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentyfifteen-ie-css'  href='http://youngblog.hoster-ok.com/wp-content/themes/twentyfifteen/css/ie.css?ver=20141010' type='text/css' media='all' />
<![endif]-->
<!--[if lt IE 8]>
<link rel='stylesheet' id='twentyfifteen-ie7-css'  href='http://youngblog.hoster-ok.com/wp-content/themes/twentyfifteen/css/ie7.css?ver=20141010' type='text/css' media='all' />
<![endif]-->
<!-- This site uses the Google Analytics by MonsterInsights plugin v5.5.4 - Universal disabled - https://www.monsterinsights.com/ -->
<script type="text/javascript">

	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-16377985-1']);
	_gaq.push(['_gat._forceSSL']);
	_gaq.push(['_trackPageview']);

	(function () {
		var ga = document.createElement('script');
		ga.type = 'text/javascript';
		ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0];
		s.parentNode.insertBefore(ga, s);
	})();

</script>
<!-- / Google Analytics by MonsterInsights -->
<script type='text/javascript' src='http://youngblog.hoster-ok.com/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='http://youngblog.hoster-ok.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var cptch_vars = {"nonce":"20be6153ab","ajaxurl":"https:\/\/youngblog.hoster-ok.com\/wp-admin\/admin-ajax.php","enlarge":"0"};
/* ]]> */
</script>
<script type='text/javascript' src='http://youngblog.hoster-ok.com/wp-content/plugins/captcha/js/front_end_script.js?ver=4.7.7'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var quotescollectionAjax = {"ajaxUrl":"https:\/\/youngblog.hoster-ok.com\/wp-admin\/admin-ajax.php","nonce":"2e33abe795","nextQuote":"Next quote \u00bb","loading":"Loading...","error":"Error getting quote","autoRefreshMax":"20","autoRefreshCount":"0"};
/* ]]> */
</script>
<script type='text/javascript' src='http://youngblog.hoster-ok.com/wp-content/plugins/quotes-collection/js/quotes-collection.js?ver=2.0.8'></script>
<link rel='https://api.w.org/' href='http://youngblog.hoster-ok.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://youngblog.hoster-ok.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://youngblog.hoster-ok.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Скрипт удаления старых томов для bacula' href='http://youngblog.hoster-ok.com/skript-udaleniya-staryh-tomov-dlya-bacula/' />
<link rel='next' title='Используем fetchmail для автоматизации разбора почты.' href='http://youngblog.hoster-ok.com/ispolzuem-fetchmail-dlya-avtomatizatsii-razbora-pochty/' />
<meta name="generator" content="WordPress 4.7.7" />
<link rel="canonical" href="http://youngblog.hoster-ok.com/ustanovka-openvpn-na-linux-mint/" />
<link rel='shortlink' href='http://youngblog.hoster-ok.com/?p=3728' />
<link rel="alternate" type="application/json+oembed" href="http://youngblog.hoster-ok.com/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fyoungblog.hoster-ok.com%2Fustanovka-openvpn-na-linux-mint%2F" />
<link rel="alternate" type="text/xml+oembed" href="http://youngblog.hoster-ok.com/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fyoungblog.hoster-ok.com%2Fustanovka-openvpn-na-linux-mint%2F&#038;format=xml" />
<!-- <meta name="NextGEN" version="2.1.62" /> -->
<style type="text/css" id="syntaxhighlighteranchor"></style>
</head>

<body class="post-template-default single single-post postid-3728 single-format-standard">
<div id="page" class="hfeed site">
	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

	<div id="sidebar" class="sidebar">
		<header id="masthead" class="site-header" role="banner">
			<div class="site-branding">
										<p class="site-title"><a href="http://youngblog.hoster-ok.com/" rel="home">youngblogger на hoster-ok.com</a></p>
											<p class="site-description">Не сомневайся! Просто сделай это!</p>
									<button class="secondary-toggle">Menu and widgets</button>
			</div><!-- .site-branding -->
		</header><!-- .site-header -->

			<div id="secondary" class="secondary">

		
		
					<div id="widget-area" class="widget-area" role="complementary">
				<aside id="search-3" class="widget widget_search"><h2 class="widget-title">Поиск по сайту</h2><form role="search" method="get" class="search-form" action="http://youngblog.hoster-ok.com/">
				<label>
					<span class="screen-reader-text">Search for:</span>
					<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" />
				</label>
				<input type="submit" class="search-submit screen-reader-text" value="Search" />
			</form></aside><aside id="categories-3" class="widget widget_categories"><h2 class="widget-title">Категории</h2>		<ul>
	<li class="cat-item cat-item-69"><a href="http://youngblog.hoster-ok.com/category/hardware/adsl-vdsl-modems/" >ADSL/VDSL модемы</a>
</li>
	<li class="cat-item cat-item-268"><a href="http://youngblog.hoster-ok.com/category/os/linux/bash/" >bash</a>
</li>
	<li class="cat-item cat-item-276"><a href="http://youngblog.hoster-ok.com/category/programs/web/cms/" >CMS</a>
</li>
	<li class="cat-item cat-item-168"><a href="http://youngblog.hoster-ok.com/category/hardware/hdd-ssd/" >HDD/SSD</a>
</li>
	<li class="cat-item cat-item-4"><a href="http://youngblog.hoster-ok.com/category/os/linux/" title="Мои записи касаемо операционной системы Linux">Linux</a>
</li>
	<li class="cat-item cat-item-304"><a href="http://youngblog.hoster-ok.com/category/os/macos/" >MacOS</a>
</li>
	<li class="cat-item cat-item-384"><a href="http://youngblog.hoster-ok.com/category/os/linux/scripts/" >Scripts</a>
</li>
	<li class="cat-item cat-item-161"><a href="http://youngblog.hoster-ok.com/category/security/vpn/" >VPN</a>
</li>
	<li class="cat-item cat-item-13"><a href="http://youngblog.hoster-ok.com/category/programs/web/" >Web</a>
</li>
	<li class="cat-item cat-item-5"><a href="http://youngblog.hoster-ok.com/category/os/windows/" title="Мои записи касаемо операционной системы Windows">Windows</a>
</li>
	<li class="cat-item cat-item-1"><a href="http://youngblog.hoster-ok.com/category/uncategorized/" >Без рубрики</a>
</li>
	<li class="cat-item cat-item-6"><a href="http://youngblog.hoster-ok.com/category/security/" title="Записи касаемо безопасности работы на компьютерах. Безопасности как в информационном плане, так и в плане физического и психического состояния и здоровья.
&quot;Безопасность - это процесс, а не результат&quot; 
- Брюс Шнайер.">Безопасность</a>
</li>
	<li class="cat-item cat-item-12"><a href="http://youngblog.hoster-ok.com/category/os/virtualization/" >Виртуализация</a>
</li>
	<li class="cat-item cat-item-229"><a href="http://youngblog.hoster-ok.com/category/os/windows/virusy/" >Вирусы</a>
</li>
	<li class="cat-item cat-item-187"><a href="http://youngblog.hoster-ok.com/category/hardware/embedded-linux/" >Встраиваемый Linux</a>
</li>
	<li class="cat-item cat-item-183"><a href="http://youngblog.hoster-ok.com/category/programs/software/grafika/" >Графика</a>
</li>
	<li class="cat-item cat-item-244"><a href="http://youngblog.hoster-ok.com/category/informatsiya/" >Информация</a>
</li>
	<li class="cat-item cat-item-137"><a href="http://youngblog.hoster-ok.com/category/os/linux/komandy/" >команды</a>
</li>
	<li class="cat-item cat-item-68"><a href="http://youngblog.hoster-ok.com/category/hardware/controllers/" >Контроллеры</a>
</li>
	<li class="cat-item cat-item-258"><a href="http://youngblog.hoster-ok.com/category/hardware/monitoring-hardware/" >мониторинг</a>
</li>
	<li class="cat-item cat-item-10"><a href="http://youngblog.hoster-ok.com/category/thought/" >Мысли</a>
</li>
	<li class="cat-item cat-item-71"><a href="http://youngblog.hoster-ok.com/category/hardware/notebooks/" >Ноутбуки</a>
</li>
	<li class="cat-item cat-item-18"><a href="http://youngblog.hoster-ok.com/category/hardware/" >Оборудование</a>
</li>
	<li class="cat-item cat-item-3"><a href="http://youngblog.hoster-ok.com/category/os/" title="Всё что касается персональных компьютеров">Операционные системы</a>
</li>
	<li class="cat-item cat-item-49"><a href="http://youngblog.hoster-ok.com/category/search-engine-systems/" >Поисковые системы</a>
</li>
	<li class="cat-item cat-item-8"><a href="http://youngblog.hoster-ok.com/category/programs/software/" >Прикладное ПО</a>
</li>
	<li class="cat-item cat-item-7"><a href="http://youngblog.hoster-ok.com/category/programs/" >Программное обеспечение</a>
</li>
	<li class="cat-item cat-item-94"><a href="http://youngblog.hoster-ok.com/category/prochee/" >Прочее</a>
</li>
	<li class="cat-item cat-item-19"><a href="http://youngblog.hoster-ok.com/category/hardware/servers/" >Серверы</a>
</li>
	<li class="cat-item cat-item-119"><a href="http://youngblog.hoster-ok.com/category/seti/" >Сети</a>
</li>
	<li class="cat-item cat-item-99"><a href="http://youngblog.hoster-ok.com/category/programs/sistemnoe-po/" >Системное ПО</a>
</li>
	<li class="cat-item cat-item-184"><a href="http://youngblog.hoster-ok.com/category/hardware/smartphones/" >Смартфоны</a>
</li>
	<li class="cat-item cat-item-376"><a href="http://youngblog.hoster-ok.com/category/programs/software/sredstva-razrabotki/" >Средства разработки</a>
</li>
	<li class="cat-item cat-item-163"><a href="http://youngblog.hoster-ok.com/category/hardware/udalyonnoe-upravlenie/" >Удалённое управление</a>
</li>
	<li class="cat-item cat-item-9"><a href="http://youngblog.hoster-ok.com/category/os/windows/utilities/" >Утилиты</a>
</li>
	<li class="cat-item cat-item-11"><a href="http://youngblog.hoster-ok.com/category/security/cryptography/" >шифрование</a>
</li>
	<li class="cat-item cat-item-47"><a href="http://youngblog.hoster-ok.com/category/humor/" >Юмор</a>
</li>
		</ul>
</aside><aside id="pages-3" class="widget widget_pages"><h2 class="widget-title">Страницы</h2>		<ul>
			<li class="page_item page-item-265 page_item_has_children"><a href="http://youngblog.hoster-ok.com/programmy/">Программы</a>
<ul class='children'>
	<li class="page_item page-item-2088"><a href="http://youngblog.hoster-ok.com/programmy/cms/">CMS</a></li>
</ul>
</li>
<li class="page_item page-item-3294"><a href="http://youngblog.hoster-ok.com/kontakt/">Контакт</a></li>
<li class="page_item page-item-2"><a href="http://youngblog.hoster-ok.com/about/">О блоге</a></li>
		</ul>
		</aside>		<aside id="recent-posts-3" class="widget widget_recent_entries">		<h2 class="widget-title">Недавние записи</h2>		<ul>
					<li>
				<a href="http://youngblog.hoster-ok.com/carbon-graphite-izmenenie-vremeni-hraneniya-dannyh/">Carbon Graphite изменение времени хранения данных</a>
						</li>
					<li>
				<a href="http://youngblog.hoster-ok.com/kak-poluchit-vse-ip-adresa-incapsula-com/">Как получить все IP адреса incapsula.com</a>
						</li>
					<li>
				<a href="http://youngblog.hoster-ok.com/kak-poluchit-vse-ip-adresa-coudflare/">Как получить все IP адреса CoudFlare</a>
						</li>
					<li>
				<a href="http://youngblog.hoster-ok.com/otklyuchenie-wpa_supplicant-na-vds-ili-desktope-gde-net-wifi/">Отключение wpa_supplicant на VDS или десктопе где нет WiFi</a>
						</li>
					<li>
				<a href="http://youngblog.hoster-ok.com/iptables-v-rhel-7-centos-7/">iptables в RHEL 7 / Centos 7</a>
						</li>
				</ul>
		</aside>					</div><!-- .widget-area -->
		
	</div><!-- .secondary -->

	</div><!-- .sidebar -->

	<div id="content" class="site-content">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
<article id="post-3728" class="post-3728 post type-post status-publish format-standard hentry category-vpn category-security category-cryptography tag-linux tag-linux-mint tag-openvpn">
	
	<header class="entry-header">
		<h1 class="entry-title">Установка openvpn на Linux mint</h1>	</header><!-- .entry-header -->

	<div class="entry-content">
		<p>Прежде всего уясните себе что машина с easy-rsa это машина которая <b>только подписывает ключи</b>. И по логике безопасности должна быть отдельной машиной. Не стоит хранить генератор ключей и в особенности приватный CA на самом VPN сервере.</p>
<p>1) ставим openvpn на VPN сервере</p>
<pre class="brush: bash; title: ; notranslate" title=""># apt-get install openvpn</pre>
<p>2) ставим easy-rsa на станции подписей</p>
<pre class="brush: bash; title: ; notranslate" title=""># apt-get install easy-rsa</pre>
<p>3) создаём каталог куда скопируем easy-rsa и там будем изменять настройки, создавать и подписывать сертификаты</p>
<pre class="brush: bash; title: ; notranslate" title=""># mkdir -p /root/sign-host/easy-rsa
# cd /root/sign-host/easy-rsa
# cp /usr/share/easy-rsa/* ./</pre>
<p><span id="more-3728"></span><br />
4) проверяем что скопировалось</p>
<pre class="brush: bash; title: ; notranslate" title=""># ls -1
build-ca
build-dh
build-inter
build-key
build-key-pass
build-key-pkcs12
build-key-server
build-req
build-req-pass
clean-all
inherit-inter
list-crl
openssl-0.9.6.cnf
openssl-0.9.8.cnf
openssl-1.0.0.cnf
pkitool
revoke-full
sign-req
vars
whichopensslcnf</pre>
<p>5) меняем переменные в конце файла <b>vars</b>. Размер ключики. Если параноя входит в ваши должностные обязанности то нужно побольше ставить. :)</p>
<pre class="brush: bash; title: ; notranslate" title=""># mcedit vars
.......
export KEY_SIZE=1024
.......
export KEY_COUNTRY=&quot;US&quot;
export KEY_PROVINCE=&quot;CA&quot;
export KEY_CITY=&quot;SanFrancisco&quot;
export KEY_ORG=&quot;Fort-Funston&quot;
export KEY_EMAIL=&quot;me@myhost.mydomain&quot;
export KEY_EMAIL=mail@host.domain
export KEY_CN=changeme
export KEY_NAME=changeme
export KEY_OU=changeme
export PKCS11_MODULE_PATH=changeme
export PKCS11_PIN=1234</pre>
<p><b>changeme</b> &#8211; замените на свои значения. Остальные также можно изменить если хотите. На работоспособность это никак не влияет. </p>
<p>Затем генерируем ключи. Команда vars запускается из шела. перед ней через пробел точка.<br />
После её запуска нужно запускать остальные.</p>
<pre class="brush: bash; title: ; notranslate" title=""># . vars
NOTE: If you run ./clean-all, I will be doing a rm -rf on /root/easy-rsa/keys
# ./clean-all 
# ./build-ca myvpn-ca
Generating a 1024 bit RSA private key
.....++++++
.................++++++
writing new private key to 'ca.key'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [US]:
State or Province Name (full name) [CA]:
Locality Name (eg, city) [SanFrancisco]:
Organization Name (eg, company) [Fort-Funston]:
Organizational Unit Name (eg, section) [my-organization]:
Common Name (eg, your name or your server's hostname) [myvpn-server]:
Name [myvpn-key]:
Email Address [mail@host.domain]:</pre>
<p>Получили ключик центра сертификации. Публичный и приватный.</p>
<pre class="brush: bash; title: ; notranslate" title="">ca.crt
ca.key</pre>
<p>Следом создадим ключик Diffie Hellman</p>
<pre class="brush: bash; title: ; notranslate" title=""># ./build-dh</pre>
<p>Он может довольно долго работать и создавать ключ. Для 1024-х бит получим файл ./keys/dh1024.pem<br />
Теперь генерируем и подписываем ключ сервера.</p>
<pre class="brush: bash; title: ; notranslate" title="">./build-key-server myvpn-server-key
Generating a 1024 bit RSA private key
............++++++
.......++++++
writing new private key to 'myvpn-server-key.key'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [US]:
State or Province Name (full name) [CA]:
Locality Name (eg, city) [SanFrancisco]:
Organization Name (eg, company) [Fort-Funston]:
Organizational Unit Name (eg, section) [my-organization]:
Common Name (eg, your name or your server's hostname) [myvpn-server-key]:
Name [myvpn-key]:
Email Address [mail@host.domain]:

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
Using configuration from /root/easy-rsa/openssl-1.0.0.cnf
Check that the request matches the signature
Signature ok
The Subject's Distinguished Name is as follows
countryName           :PRINTABLE:'US'
stateOrProvinceName   :PRINTABLE:'CA'
localityName          :PRINTABLE:'SanFrancisco'
organizationName      :PRINTABLE:'Fort-Funston'
organizationalUnitName:PRINTABLE:'my-organization'
commonName            :PRINTABLE:'myvpn-server-key'
name                  :PRINTABLE:'myvpn-key'
emailAddress          :IA5STRING:'mail@host.domain'
Certificate is to be certified until May 17 13:58:59 2024 GMT (3650 days)
Sign the certificate? [y/n]:y


1 out of 1 certificate requests certified, commit? [y/n]y
Write out database with 1 new entries
Data Base Updated
</pre>
<p>Это добавило ещё 3 файла в каталог ./keys/</p>
<pre class="brush: bash; title: ; notranslate" title="">myvpn-server-key.crt
myvpn-server-key.csr
myvpn-server-key.key</pre>
<p>Ну и теперь генерируем ключи для клиентов. Если клиенты будут иметь разные ключи то сколько клиентов столько раз и запускать. Не забывайте каждый раз менять (номер) ключа. Ну или можете назвать по именам реальных клиентов vasya-key, roma-key и т д.</p>
<pre class="brush: bash; title: ; notranslate" title="">./build-key myvpn-client1-key
Generating a 1024 bit RSA private key
...................++++++
................++++++
writing new private key to 'myvpn-client1-key.key'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [US]:
State or Province Name (full name) [CA]:
Locality Name (eg, city) [SanFrancisco]:
Organization Name (eg, company) [Fort-Funston]:
Organizational Unit Name (eg, section) [my-organization]:
Common Name (eg, your name or your server's hostname) [myvpn-client1-key]:
Name [myvpn-key]:
Email Address [mail@host.domain]:

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
Using configuration from /root/easy-rsa/openssl-1.0.0.cnf
Check that the request matches the signature
Signature ok
The Subject's Distinguished Name is as follows
countryName           :PRINTABLE:'US'
stateOrProvinceName   :PRINTABLE:'CA'
localityName          :PRINTABLE:'SanFrancisco'
organizationName      :PRINTABLE:'Fort-Funston'
organizationalUnitName:PRINTABLE:'my-organization'
commonName            :PRINTABLE:'myvpn-client1-key'
name                  :PRINTABLE:'myvpn-key'
emailAddress          :IA5STRING:'mail@host.domain'
Certificate is to be certified until May 17 14:03:29 2024 GMT (3650 days)
Sign the certificate? [y/n]:y


1 out of 1 certificate requests certified, commit? [y/n]y
Write out database with 1 new entries
Data Base Updated
</pre>
<p>Получили три файла на каждого клиента</p>
<pre class="brush: bash; title: ; notranslate" title="">myvpn-client1-key.crt
myvpn-client1-key.csr
myvpn-client1-key.key</pre>
<p>Ну и для комплекта сгенерим ещё и TA ключ.</p>
<pre class="brush: bash; title: ; notranslate" title="">openvpn --genkey --secret &quot;$EASY_RSA/keys/myvpn-server-ta.key&quot;</pre>
<p>В результате добавится ключик ./keys/myvpn-server-ta.key<br />
Поздравляю! С ключами закончили.</p>
<p>Теперь берите пять (5) ключей:</p>
<pre class="brush: bash; title: ; notranslate" title="">dh1024.pem
ca.crt
myvpn-server-ta.key
myvpn-server-key.crt
myvpn-server-key.key</pre>
<p>и копируете на сервер в каталог /etc/openvpn/<br />
Копируете по закрытому соединению. scp например. или флешкой перенесите.<br />
Затем берёте четыре (4) ключа:</p>
<pre class="brush: bash; title: ; notranslate" title="">ca.crt
myvpn-server-ta.key
myvpn-client1-key.crt
myvpn-client1-key.key</pre>
<p>и копируете их на клиента в каталог /etc/openvpn/ или в соответствующий каталог на windows<br />
Аналогично копируете соблюдая меры безопасности.<br />
Теперь осталось сделать конфиги.<br />
Сервер /etc/openvpn/myvpn-server.conf</p>
<pre class="brush: bash; title: ; notranslate" title="">port 443
proto udp
dev tun1

user nobody
group nogroup

dh       /etc/openvpn/dh1024.pem
ca       /etc/openvpn/ca.crt
cert     /etc/openvpn/myvpn-server-key.crt
key      /etc/openvpn/myvpn-server-key.key
tls-auth /etc/openvpn/myvpn-server-ta.key 0

server 10.10.0.0 255.255.255.0
push &quot;redirect-gateway&quot;
push &quot;dhcp-option DNS 10.10.0.1&quot;
push &quot;explicit-exit-notify 3&quot;

client-config-dir ccd
keepalive 10 60

#duplicate-cn

auth SHA1
cipher AES-256-CBC   # AES
comp-lzo

max-clients 128
persist-key
persist-tun

ifconfig-pool-persist /var/log/openvpn-ipp-udp443.txt
status                /var/log/openvpn-status-udp443.log
log                   /var/log/openvpn-udp443.log
verb 3
</pre>
<p>Клиенты /etc/openvpn/myvpn-client.conf</p>
<pre class="brush: bash; title: ; notranslate" title="">client
dev tun1
proto udp
remote xxx.xxx.xxx.xxx 443
resolv-retry infinite
nobind
persist-key
persist-tun

ns-cert-type server

ca       /etc/openvpn/ca.crt
cert     /etc/openvpn/myvpn-client1-key.crt
key      /etc/openvpn/myvpn-client1-key.key
tls-auth /etc/openvpn/myvpn-server-ta.key 1

# разрешаем запускать скрипты
script-security 2
# на поднятие и опускание vpn запускаем скрипт обновления файла resolv.conf
up /etc/openvpn/update-resolv-conf
down /etc/openvpn/update-resolv-conf

cipher AES-256-CBC
log /var/log/openvpn.log
comp-lzo
verb 3</pre>
<p>Готово.<br />
Заускаем</p>
<pre class="brush: bash; title: ; notranslate" title=""># service openvpn start</pre>
<p>Проверяем что запустился</p>
<pre class="brush: bash; title: ; notranslate" title=""># netstat -nlp -A inet | grep openvpn
udp        0      0 0.0.0.0:443             0.0.0.0:*                           2075/openvpn</pre>
<p>Теперь важно открыть на Firewall UDP 443 на нужном интерфейсе.</p>
<pre class="brush: bash; title: ; notranslate" title=""># ufw allow 443/udp</pre>
<p>И не забыть проверить и настроить SELinux если он установлен и включён.<br />
Если вдруг openvpn не запустился временно отключить SELinux можно так:</p>
<pre class="brush: bash; title: ; notranslate" title=""># setenforce 0</pre>
<p>Дальше нужно включить автозапуск как на сервере так и на клиентах если это нужно.<br />
Для этого раскомментируем или добавим опцию <b>AUTOSTART</b></p>
<pre class="brush: bash; title: ; notranslate" title=""># mcedit /etc/default/openvpn
...
AUTOSTART=all
...</pre>
	</div><!-- .entry-content -->

	
	<footer class="entry-footer">
		<span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="http://youngblog.hoster-ok.com/ustanovka-openvpn-na-linux-mint/" rel="bookmark"><time class="entry-date published" datetime="2014-05-20T16:41:37+00:00">20.05.2014</time><time class="updated" datetime="2014-05-20T23:55:10+00:00">20.05.2014</time></a></span><span class="byline"><span class="author vcard"><span class="screen-reader-text">Author </span><a class="url fn n" href="http://youngblog.hoster-ok.com/author/admin/">admin</a></span></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="http://youngblog.hoster-ok.com/category/security/vpn/" rel="category tag">VPN</a>, <a href="http://youngblog.hoster-ok.com/category/security/" rel="category tag">Безопасность</a>, <a href="http://youngblog.hoster-ok.com/category/security/cryptography/" rel="category tag">шифрование</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="http://youngblog.hoster-ok.com/tag/linux/" rel="tag">Linux</a>, <a href="http://youngblog.hoster-ok.com/tag/linux-mint/" rel="tag">linux mint</a>, <a href="http://youngblog.hoster-ok.com/tag/openvpn/" rel="tag">OpenVPN</a></span>			</footer><!-- .entry-footer -->

</article><!-- #post-## -->

	<nav class="navigation post-navigation" role="navigation">
		<h2 class="screen-reader-text">Post navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="http://youngblog.hoster-ok.com/skript-udaleniya-staryh-tomov-dlya-bacula/" rel="prev"><span class="meta-nav" aria-hidden="true">Previous</span> <span class="screen-reader-text">Previous post:</span> <span class="post-title">Скрипт удаления старых томов для bacula</span></a></div><div class="nav-next"><a href="http://youngblog.hoster-ok.com/ispolzuem-fetchmail-dlya-avtomatizatsii-razbora-pochty/" rel="next"><span class="meta-nav" aria-hidden="true">Next</span> <span class="screen-reader-text">Next post:</span> <span class="post-title">Используем fetchmail для автоматизации разбора почты.</span></a></div></div>
	</nav>
		</main><!-- .site-main -->
	</div><!-- .content-area -->


	</div><!-- .site-content -->

	<footer id="colophon" class="site-footer" role="contentinfo">
                <div yandex>
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
(function (d, w, c) {
    (w[c] = w[c] || []).push(function() {
        try {
            w.yaCounter1049947 = new Ya.Metrika({id:1049947,
                    webvisor:true,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true});
        } catch(e) { }
    });

    var n = d.getElementsByTagName("script")[0],
        s = d.createElement("script"),
        f = function () { n.parentNode.insertBefore(s, n); };
    s.type = "text/javascript";
    s.async = true;
    s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";

    if (w.opera == "[object Opera]") {
        d.addEventListener("DOMContentLoaded", f, false);
    } else { f(); }
})(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="//mc.yandex.ru/watch/1049947" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
                </div>
		<div class="site-info">
						<a href="https://wordpress.org/">Proudly powered by WordPress</a>
		</div><!-- .site-info -->
	</footer><!-- .site-footer -->

</div><!-- .site -->

<!-- ngg_resource_manager_marker --><script type='text/javascript' src='http://youngblog.hoster-ok.com/wp-content/plugins/contact-form-7/includes/js/jquery.form.min.js?ver=3.51.0-2014.06.20'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var _wpcf7 = {"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}}};
/* ]]> */
</script>
<script type='text/javascript' src='http://youngblog.hoster-ok.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=4.6'></script>
<script type='text/javascript' src='http://youngblog.hoster-ok.com/wp-content/themes/twentyfifteen/js/skip-link-focus-fix.js?ver=20141010'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var screenReaderText = {"expand":"<span class=\"screen-reader-text\">expand child menu<\/span>","collapse":"<span class=\"screen-reader-text\">collapse child menu<\/span>"};
/* ]]> */
</script>
<script type='text/javascript' src='http://youngblog.hoster-ok.com/wp-content/themes/twentyfifteen/js/functions.js?ver=20150330'></script>
<script type='text/javascript' src='http://youngblog.hoster-ok.com/wp-includes/js/wp-embed.min.js?ver=4.7.7'></script>
<script type='text/javascript' src='http://youngblog.hoster-ok.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.9b'></script>
<script type='text/javascript' src='http://youngblog.hoster-ok.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushBash.js?ver=3.0.9b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://youngblog.hoster-ok.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://youngblog.hoster-ok.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeRDark.css?ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();
</script>

</body>
</html>
